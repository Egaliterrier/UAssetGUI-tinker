<UserControl x:Class="UAssetManager.Controls.Editors.ArrayEditor"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:c="clr-namespace:UAssetManager.Controls">

    <DockPanel>
        <Grid DockPanel.Dock="Top" Margin="0,0,0,8" Grid.IsSharedSizeScope="True">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBlock VerticalAlignment="Center" Margin="0,0,8,0" Grid.Column="0">
                <Run Text="{Binding ItemsSource.Count,ElementName=ItemsList,Mode=OneWay}" />
                <Run Text="{DynamicResource ArrayEditor.ArrayElements}" />
            </TextBlock>
            <Button Grid.Column="1" Content="{DynamicResource ArrayEditor.Add}" Width="72" Click="Insert_Click"/>
        </Grid>

        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <ItemsControl x:Name="ItemsList">
                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter">
                        <Setter Property="Margin" Value="0,0,0,6" />
                    </Style>
                </ItemsControl.ItemContainerStyle>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border x:Name="Boarder" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" CornerRadius="4" Background="{DynamicResource RegionBrush}">
                            <Expander IsExpanded="{Binding IsExpanded, Mode=TwoWay}">
                                <Expander.Header>
                                    <Border Background="#0F000000" Padding="6,3" Width="{Binding ActualWidth,ElementName=Boarder}">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0" VerticalAlignment="Top" Opacity="0.8">
                                                <Run Text="["/>
                                                <Run Text="{Binding Index}"/>
                                                <Run Text="]"/>
                                            </TextBlock>
                                            <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="6 0 50 0">
                                                <!-- <TextBlock VerticalAlignment="Top" Text="{Binding}" TextTrimming="CharacterEllipsis" /> -->
                                                <c:PropertyEditor Asset="{Binding Asset,Mode=OneWay}" Source="{Binding PropertyData}" Margin="8,0,0,0" 
                                                                  Visibility="{Binding IsObjectProperty,Converter={StaticResource BooleanToVisibilityConverter}}" />
                                            </StackPanel>
                                            
                                            <Button x:Name="MoreButton" Grid.Column="2" Content="â–¾" Width="20" Height="20" ToolTip="More" VerticalAlignment="Top" 
                                                    Click="MoreButton_Click" MouseRightButtonDown="MoreButton_Click" Tag="{Binding}" />
                                            <Popup x:Name="MorePopup" Placement="Bottom" PlacementTarget="{Binding ElementName=MoreButton}" StaysOpen="False">
                                                <Border Background="#2D2D30" BorderBrush="#3E3E42" BorderThickness="1" CornerRadius="6">
                                                    <Border.Effect>
                                                        <DropShadowEffect Color="Black" Direction="270" ShadowDepth="4" BlurRadius="8" Opacity="0.3"/>
                                                    </Border.Effect>
                                                    <StackPanel Margin="2">
                                                        <Button Content="{DynamicResource Text.Insert}" Click="Insert_Click" CommandParameter="{Binding}" 
                                                                Style="{StaticResource UnrealMenuButtonStyle}" />
                                                        <Button Content="{DynamicResource Text.Delete}" Click="Remove_Click" CommandParameter="{Binding}" 
                                                                Style="{StaticResource UnrealMenuButtonStyle}" />
                                                        <Button Content="{DynamicResource Text.Copy}" Click="Copy_Click" CommandParameter="{Binding}" 
                                                                Style="{StaticResource UnrealMenuButtonStyle}" />
                                                    </StackPanel>
                                                </Border>
                                            </Popup>
                                        </Grid>
                                    </Border>
                                </Expander.Header>
                                <Border Padding="6,6,6,8">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsObjectProperty}" Value="True">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <c:PropertyEditor Asset="{Binding Asset,Mode=OneWay}" Source="{Binding PropertyData}" />
                                </Border>
                            </Expander>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </DockPanel>
</UserControl>